# Math Basic Notes

## 牌效策略

基于 **向听数** 与 **进张数**, 适当考虑 **高番数**:

- 摸入后可以减少向听数的牌称为**进张**.
- 摸入后可以增加进张数的牌称为**改良**.
- **进张**与**改良**合称为**有效牌**.

### 单张牌效

切牌顺序:

- 客风牌 / (**`1`** 4, 6 **`9`**).
- `1` `9`: 孤立的老头牌比任何一种对子和搭子的价值都要低.
- 役牌.
- `2` `8`.
- `3` `4` `5` `6` `7`.

### 对子牌效

- 两对子双碰: 两对子存在双碰进张.
- 三对子不利: 相比于两对子, 仅增加 2 张刻子进张.
  - 常常考虑切掉 1 对子, 并保证向听数不减少: 切两面对 -> 切嵌张对 -> 切边张对.
  - 有役时 (如役牌或对对和), 可将**碰**作为进张手段.
- 四对子: 可考虑七对子役种.

### 搭子牌效

- 搭子: 两面 > 连嵌 > 嵌张 > 边张.
- **五块理论**: 五搭子饱和, 六搭子不利.
- 五搭子形基本上只要切掉价值最低的浮牌.
- `1x4` / `6x9`:
  - 有效牌重复效应: `147`, `258`, `369` 同一筋上存在有效牌重复效应.
  - 边张有效牌重复: `14` / `69` 存在时, `1` `9` 价值甚至低于客风牌.
  - `14` 进 `2`/`3`, 形成 `124`/`134`, 仍然切 `1`, 所以可以在 `14` 时就切 `1`.
- 存在二度进张的边张搭子，切掉边张搭子保留浮牌比较有利.
- 搭子超载时, 优先切掉弱搭子:
  - **低效率二度进张**: 考虑有效牌重复效应, 可以切掉同色超载搭子 (进张数损失最小).
  - 存在复合型时, 可以先切边张: 价值低.
  - 不存在复合型时, 可以先切中张: 危险度高.
- 双碰进张优于连嵌进张, 特别是在有役牌时, **碰**的几率远大于**吃**.
- **高向听**时, 禁止切掉唯一一组雀头 (切掉后会导致向听数减小).

### 三牌复合型

- 两面对: `233`.
- 嵌张对: `244`.
- 边张对: `122`.
- 连嵌张: `246`.
  - 两面嵌张: `2` + `456` + `67` -> `246` + `567`.
  - 长连嵌张: `134568`, 进 `2` 或 `7` 都可形成两面子.
  - 弱于两面搭子: 需要 3 张牌, 听牌型为嵌张听.

搭子进张成为搭子 + 对子复合型, 称该进张为**补强牌**:

- 两对子双碰:
  当出现两组复合型二择时,
  切掉搭子部位较弱的复合型的**搭子**,
  固定两对子双碰牌型.
- 三对子不利:
  当出现三对子不利时,
  切掉搭子部位较强的复合型的**对子** (如两面对),
  **让补强牌辅助较弱的搭子**,
  固定强搭子牌型 (复合型 - 对子 = 搭子),
  即**固定好型**,
  切掉三对子不利牌型.
- 固定好型的方法还可以将复合型的数量考虑进去:
  `335577` 中,
  `335` 是一个嵌张对,
  `355` + `557` 是两个嵌张对,
  `577` 是一个嵌张对,
  一般选择切 `5`, 固定中间连嵌好型.

`13345667m` + `123788s`:

先根据五块理论与中膨复合型, 将手牌分为 `133m` + `456m` + `67m` + `123s` + `788s`.
可以此时已经形成了有效的五块搭子, 需要切掉两个三牌复合型中的一个, 保持张数的正收益.
对于`对子` + `搭子`的复合型, 可以采取固定好型的策略, 切掉 `8s`, 固定 `78s` 两面型.
显然切掉 `3m` 去固定 `13m` 嵌张型是低效率的切法.

### 四牌复合型

- 四连型 (延伸单骑):
  - 良型: `3456` -> `34` + `56`, 常常将其视为**两面 + 两面**, 而不是单骑进张.
  - 次良型: `1234` -> `123` + `4`, 常常将其视为单骑进张, 而不是**边张 + 两面**.
  - 缺少对子时, 四连型的延伸单骑价值上升; 不缺对子时, 四连型的延伸单骑价值下降.
- 中膨型:
  - 良型: `3445` -> `34` + `45`, 两面 + 一杯口.
  - **恶型**: `1223` -> `123` + `2`, 价值较低, 接近于单张 `2`, 可优先切掉 `2`, 保留其他单张 (如 `4`, `7`).
- 亚两面型:
  - `3345` -> `33` + `45` 对子 + 两面.
  - `1233` (对子 + 边张) 不是亚两面型.
  - `1123` (对子 + 两面) 是亚两面型.
  - 缺少对子时, `3345` 有一定价值, 稍稍高于单张 `3`.
  - 不缺对子时, `3345` 价值较低, 接近于单张 `3`, 可优先切掉 `3`, 保留其他复合型.
  - `1123` 价值接近于单张 `1`, `7899` 价值接近于单张 `9`.
  - 总体来说, 亚两面型作两面能力与孤张无太大区别.
  - `3345` -> `35` + `34`, 可以通过鸣牌改良成 `34` 两面.
  - 亚两面型可以直接勇于听牌, 存在转二杯口可能性, 可以形成 `33345` 暗刻复合型.
- 跳一型:
  - `1235`/`5789` 接近于孤张 `5`.
  - `1345`/`5679` 中的 `1`/`9` 比孤张 `1`/`2`/`8`/`9` 强.
  - `3457` 可以形成良型 `34567`, 利用**吃**可以形成两面子.
- 强度: 四连型 > 中膨型 >> 亚两面型.

`1234p` 与 `1123s`:

当手牌缺少对子时, 四连型中的 `1p` 可以解放 `4p`, 进张下一个 `4p` 时, 可以形成面子 + 雀头,
即 `1p` + `234p` -> `123p` + `4p`, 使得 `1p` 价值约等于 `4p`.

而亚两面型中的 `1s` + `123s` 却无法解放 `3s`, 使得 `1s` 价值约等于 `1s`.
比较 `4p` 与 `1s` 价值, 可以得出此时应该切 `1s`, 保留 `1p`.

### 多张复合型

- 暗刻复合型: `333` + `45` -> `33` + `345`, 缺少对子时, 价值上升.
- `23578` 切 5.
- `34455`: `345` + `45`.
- `344556`: `345` + `456`.
- `2267888`: `22` + `88` + `678` / `67` + `22` + `888`.

### 两向听策略

- `面子` + `雀头` + 3 `搭子`: 优先切掉低价值浮牌.
- `面子` + 4 `搭子`:

### 一向听策略

- 接近听牌时 (不再缺少搭子),
  可考虑切掉四牌复合型 (四张牌挤占空间) 退回面子 (固定好型),
  保留三牌复合型 (两面对/嵌张对/连嵌张),
  固定 `搭子` + `搭子` 型,
  可以提升直接进张数量.
- `暗刻` + `面子` + `两搭子` 低向听, 不固定雀头进张数更多.
- 完全一向听:
  - 面子 + 面子 + 对子 + 两面 + 两面对.
- 撞头一向听:
  - 3 面子 + 1 雀头 + 2 单张.
  - 质量较高的一向听, 单张与面子形成复合型后会进一步提升进张数量.

### 听牌策略

- 两面听: `23` 听 `1` `4`.
- 双碰听: `22` `55` 听 `2` `5`.
- 嵌张听: `24` 听 `3`.
- 边张听: `12` 听 `3`, `89` 听 `7`.
- 单骑听: 雀头.
- 听牌数: 两面听 > 双碰听 > 嵌张听 > 边张听 > 单骑听.
  - 两面听优势明显, 听牌数为 8.
  - 单骑听变化多, 难以防守， 特别是听熟张字牌容易荣和.
- 四连型与亚两面型听牌数都为 6.
- 暗刻复合型:
  - `1222`: 边张单骑, `1` + `222` / `12` + `22`, 听牌数为 7.
  - `3555`: 嵌张单骑, `3` + `555` / `35` + `55`, 听牌数为 7.
  - `3444`: 两面单骑, `3` + `444` / `34` + `44`, 听牌数为 11.
- 三面听:
  - 听三种牌.
  - 基本三面听: `34567` -> `34` + `567` / `345` + `67`, 听牌数为 11.
  - 单骑三面听: `1234567`, `2234567`, `4566789`, 听牌数为 9.
  - 混合三面听: `23445566`, 可以形成一杯口.
  - 多面听时, 三暗刻也可看作`雀头`+`单张`.
- 满贯以下听高点, 满贯以上听张数.
- 可以考虑高番数减低向听数:
  - 断平和: 切边张搭子.
  - 混一色/清一色: 切同色搭子 (甚至面子)

## 鸣牌策略

- 吃: 顺子 + 上家.
- 碰: 刻子 + 任意家.
- 杠:
  - 大明杠.
  - 加杠 (碰上加杠).
  - 暗杠 (自摸暗杠): 不属于鸣牌.

:::tip 门清限定
门前清指没有任何鸣牌 (暗杠不属于鸣牌).

立直麻将诸多役种都需要在门清状况下才成立,
称为门清限定.
:::

:::tip 鸣牌降番
某些役种在存在鸣牌的情况下,
会比门前清胡牌时少一番.
:::

## 手役策略

### 常见役种

- 一番役:
  - 立直: **(门清)** 报听.
  - 一发: **(门清)** 立直一巡内自摸.
  - 断幺九: 二八数牌.
  - 役牌: `场风牌`/`自风牌`/`三元牌` 刻子或杠子.
  - 平和: **(门清)** 四顺子 + 两面听 + 非役牌雀头.
  - 门清自摸和.
  - 一杯口: **(门清)** 两相同顺子.
  - 岭上开花: 杠牌后摸岭上牌自摸.
  - 海底摸月: 海底牌自摸.
  - 河底捞鱼: 海底牌荣和.
- 二番役:
  - 三色同顺: **(降番)** 三组数字相同, 花色不同的顺子.
  - 一气贯通 (一通): **(降番)** 1-9 同色顺子.
  - 混全带幺九 (混全/全带): **(降番)** 所有元素包含至少一张幺九牌.
  - 七对子 (七对): **(门清)** 不可有相同对子.
  - 对对和 (对对). 四面子都是刻子或杠子.
  - 三暗刻: 手牌有三暗刻或暗杠.
- 三番役:
  - 混一色 (混一): **(降番)** 所有元素由同一种花色和字牌构成.
  - 纯全带幺九 (纯全): **(降番)** 所有元素包含至少一张老头牌.
- 六番役:
  - 清一色 (清一): **(降番)** 所有元素由同一种花色构成.

### 宝牌策略

### 立直策略

## 振听规则

处在振听状态下, 无法荣和, 只能自摸.

### 捨牌振听

- 曾打出过当前听牌 (胡牌型, 不考虑役种), 进入捨牌振听, 所有听牌都无法荣和, 只能自摸.
- 解除方法: 换听其他没有振听的牌.
- 意味着可以**安全打出**其他三家**河牌与副露**,
  通过看牌避免放铳, 强调立直麻将的防守性.

### 同巡振听

- 听牌时, 没有荣和他人的牌, 进入同巡振听.
- 解除方法: 下一次自己打出任何牌.
- 意味着在一巡中可以**安全打出**上家打出过的牌,
  通过看牌避免放铳, 强调立直麻将的防守性.

### 立直振听

- 立直听牌时, 若出现可以胡的牌, 但没有进行胡牌, 进入立直后振听.
- 一直持续到此局结束, 意味着此局只能自摸.

:::tip 竞技麻将
振听规则是奠定立直麻将防守战术的基石.
:::

## 防守策略

- 筋牌: `147`, `258`, `369`.
  - 满筋: 现物有 `1` `7`, 则 `4` 是满筋牌.
  - 边筋: 现物有 `4` `6`, 则 `1` `9` 是边筋牌.
  - 半筋: 现物只有 `1`, 则 `4` 是半筋牌, 不太安全 (e.g `156` 切 `1` 听 `47`).
- 壁牌: 四枚可见 `+1`/`-1`.
- 薄壁牌: 四枚可见 `+1`/`-1`.
- 早巡手切边张, 外侧牌安全.
- 早巡手切 `5`, `1`/`4`/`6`/`9` 危险度提升, 晚巡手切 `5`, `5` 周围牌危险度提升.

筋牌和壁牌可用于判断某张牌的安全程度:

- `2` 四枚可见 + 现物 `7`: `4` 的安全性大大增加.
- 安全度: 现物 > 熟字 > 筋牌 > 早巡外侧 > 边张 > 生张.

## Mahjong Reference

- [Beginner's Luck](http://beginners.biz/kihon)
- [魔女ブログ](https://puyokururu.medium.com)
- [おしえて！科学する麻雀](https://book.douban.com/subject/20390543)
- [Li, Junjie, et al. "Suphx: Mastering mahjong with deep reinforcement learning." arXiv preprint arXiv:2003.13590 (2020)](https://arxiv.org/pdf/2003.13590.pdf)
